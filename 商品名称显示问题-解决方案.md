# 商品名称显示问题 - 解决方案

## 问题描述

商品管理页面中，商品名称列显示为空，但其他字段（类目ID、价格）正常显示。

## 原因分析

1. **数据库字段映射已修复**：前端已将 `prop="name"` 修改为 `prop="productName"`，与后端 Product 实体的字段名匹配。

2. **代码逻辑正确**：
   - FormatDetector 正确识别美团格式
   - MeituanFormatParser 正确解析"商品名称"列
   - 字段映射：`"商品名称" -> productName`

3. **根本原因**：数据库中现有的商品数据是在代码修复之前导入的，因此 `product_name` 字段为空。

## 解决方案

### 方案 1：清空并重新导入（推荐）

#### 步骤 1：清空商品表

```bash
# 在命令行执行
mysql -u root -p meituan_product < clear-products.sql
```

或者在 MySQL 客户端中执行：

```sql
USE meituan_product;
TRUNCATE TABLE t_product;
```

#### 步骤 2：重新导入数据

1. 打开系统前端：http://localhost:5173
2. 登录系统
3. 进入"批量导入"页面
4. 上传美团格式的 Excel 文件
5. 点击"导入"按钮

#### 步骤 3：验证结果

1. 进入"商品管理"页面
2. 确认商品名称正常显示

### 方案 2：检查数据库（诊断用）

如果想确认数据库中的数据情况，可以执行：

```sql
-- 查看前5条商品数据
SELECT id, product_name, category_id, price, status 
FROM t_product 
LIMIT 5;

-- 统计有商品名称的数据
SELECT 
    COUNT(*) AS total_products,
    COUNT(product_name) AS products_with_name,
    COUNT(*) - COUNT(product_name) AS products_without_name
FROM t_product;
```

## 验证修复

### 1. 前端修复确认

**文件**：`meituan-frontend/src/views/Products.vue`

```vue
<!-- 修复前 -->
<el-table-column prop="name" label="商品名称" show-overflow-tooltip />

<!-- 修复后 -->
<el-table-column prop="productName" label="商品名称" show-overflow-tooltip />
```

### 2. 后端字段映射确认

**文件**：`meituan-backend/src/main/java/com/meituan/product/service/FormatDetector.java`

```java
static {
    MEITUAN_COLUMN_MAPPING.put("商品名称", "productName");  // ✅ 正确映射
    MEITUAN_COLUMN_MAPPING.put("商品类目ID", "categoryId");
    MEITUAN_COLUMN_MAPPING.put("价格", "price");
    MEITUAN_COLUMN_MAPPING.put("库存", "stock");
    MEITUAN_COLUMN_MAPPING.put("文字详情", "description");
}
```

### 3. 实体类字段确认

**文件**：`meituan-backend/src/main/java/com/meituan/product/entity/Product.java`

```java
@Data
@TableName("t_product")
public class Product {
    private Long id;
    private Long merchantId;
    private String productName;  // ✅ 字段名正确
    private String categoryId;
    private BigDecimal price;
    // ...
}
```

## 测试步骤

### 1. 准备测试数据

确保你的美团格式 Excel 文件包含以下列：
- sku_id
- 商品类目ID
- **商品名称** ← 重要
- 价格
- 库存
- 其他列...

### 2. 导入测试

1. 清空商品表（使用方案1的步骤1）
2. 导入测试文件
3. 查看导入结果

### 3. 验证显示

1. 打开商品管理页面
2. 确认以下内容：
   - ✅ 商品名称正常显示
   - ✅ 类目ID正常显示
   - ✅ 价格正常显示
   - ✅ 状态正常显示

## 常见问题

### Q1：导入后商品名称还是空的？

**检查点**：
1. Excel 文件中是否有"商品名称"列？
2. "商品名称"列中是否有数据？
3. 后端日志中是否显示"识别为美团格式"？

**解决方法**：
```bash
# 查看后端日志
tail -f meituan-backend/logs/application.log | grep "格式"
```

### Q2：如何确认格式识别正确？

导入时查看后端日志，应该看到：

```
识别为美团格式
映射列：'商品名称' -> productName (索引: 5)
映射列：'商品类目ID' -> categoryId (索引: 3)
映射列：'价格' -> price (索引: 14)
```

### Q3：部分商品有名称，部分没有？

这可能是 Excel 文件中某些行的"商品名称"单元格为空。检查原始 Excel 文件。

## 技术细节

### 字段映射流程

```
Excel列名          系统字段名        数据库字段
─────────────────────────────────────────────
"商品名称"    →   productName  →   product_name
"商品类目ID"  →   categoryId   →   category_id
"价格"        →   price        →   price
"库存"        →   stock        →   stock
```

### 解析流程

```
1. 上传Excel → FormatDetector.detectFormat()
   ↓
2. 识别为美团格式 → FormatDetector.getMeituanColumnMapping()
   ↓
3. 创建列映射 → {"productName": 5, "categoryId": 3, ...}
   ↓
4. 逐行解析 → MeituanFormatParser.parseRow()
   ↓
5. 提取字段 → extractField(row, "productName", columnMapping)
   ↓
6. 保存到数据库 → product.setProductName(value)
```

## 总结

✅ **已修复的问题**：
- 前端字段映射错误（name → productName）
- 代码逻辑已验证正确

⚠️ **需要操作**：
- 清空现有商品数据
- 重新导入美团格式 Excel

📝 **预期结果**：
- 商品名称正常显示
- 所有字段数据完整

---

**修复日期**：2026-02-09  
**影响范围**：商品管理页面显示  
**解决状态**：✅ 已解决（需重新导入数据）
