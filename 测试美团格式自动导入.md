# 测试美团格式自动导入功能

## 🎯 测试目标
验证系统能够自动识别并导入美团格式的Excel文件（3752行，50+列），无需手动转换。

## 📋 准备工作

### 1. 确保服务正常运行
```bash
# 启动后端服务（端口8080）
start-backend.bat

# 启动前端服务（端口5173）
start-frontend.bat
```

### 2. 准备测试文件
测试文件位置：`E:\YCZL-company\order_project\MT_product_bulk_uploader\资源\商品的类目信息.xlsx`
- 包含3752行商品数据
- 包含50+列（美团格式）
- 必需列：商品类目ID、商品名称、价格

## 🧪 测试步骤

### 测试1：预览功能
1. 打开浏览器访问：`http://localhost:5173`
2. 登录系统（如果需要）
3. 进入"批量导入"页面
4. 点击或拖拽上传 `商品的类目信息.xlsx`
5. 点击"下一步：预览数据"

**预期结果**：
- ✅ 显示"已识别为美团格式，系统将自动转换数据"
- ✅ 显示统计信息：总计3752行，预计成功X行，Y行存在错误
- ✅ 显示前20行预览数据
- ✅ 如果有错误，显示错误详情（行号、字段名、错误原因）
- ✅ 显示"仅显示前20行"提示

### 测试2：错误报告
如果预览时发现错误：

**检查错误信息是否包含**：
- ✅ 行号（第X行）
- ✅ 字段名（如：类目ID、商品名称、价格）
- ✅ 错误原因（如：类目ID必须是10位数字）
- ✅ 原始值（如果有）

**常见错误类型**：
1. 类目ID不是10位数字
2. 类目ID为空
3. 商品名称为空
4. 价格为空或无效
5. 价格超出范围（0 < price <= 99999.99）

### 测试3：导入功能
1. 在预览页面点击"确认导入"
2. 等待导入完成

**预期结果**：
- ✅ 显示格式类型（美团格式）
- ✅ 显示成功数量
- ✅ 显示失败数量
- ✅ 显示总计数量
- ✅ 显示处理耗时
- ✅ 如果有失败，显示详细错误列表
- ✅ 显示"还有X条错误未显示"（如果错误超过100条）

### 测试4：标准格式兼容性
1. 下载标准模板（点击"下载导入模板"）
2. 填写几行测试数据
3. 上传标准模板文件

**预期结果**：
- ✅ 显示"已识别为标准格式"
- ✅ 正常预览和导入
- ✅ 不影响原有功能

## 📊 测试检查清单

### 格式识别
- [ ] 美团格式（50+列）能正确识别
- [ ] 标准格式（6列）能正确识别
- [ ] 显示正确的格式提示信息

### 数据解析
- [ ] 商品名称正确提取
- [ ] 类目ID正确提取
- [ ] 价格正确提取
- [ ] 库存正确提取（空值默认0）
- [ ] 描述正确提取（超长自动截取）

### 数据验证
- [ ] 类目ID必须是10位数字
- [ ] 价格必须 >0 且 ≤99999.99
- [ ] 商品名称必须非空且 ≤255字符
- [ ] 库存为空时默认为0
- [ ] 描述超过1000字符时自动截取

### 错误处理
- [ ] 错误信息包含行号
- [ ] 错误信息包含字段名
- [ ] 错误信息包含错误原因
- [ ] 错误信息包含原始值
- [ ] 错误数量超过100条时显示提示

### 预览功能
- [ ] 显示格式识别信息
- [ ] 显示统计信息（总计、成功、失败）
- [ ] 限制显示前20行
- [ ] 显示"仅显示前20行"提示
- [ ] 显示错误详情（前5条）

### 导入功能
- [ ] 显示格式类型
- [ ] 显示处理耗时
- [ ] 显示详细统计
- [ ] 显示错误详情（前100条）
- [ ] 错误超过100条时显示剩余数量

### 性能测试
- [ ] 3752行数据预览时间 < 10秒
- [ ] 3752行数据导入时间 < 30秒
- [ ] 内存使用正常（无内存溢出）
- [ ] 浏览器响应正常（无卡顿）

## 🐛 常见问题排查

### 问题1：格式识别错误
**症状**：美团格式被识别为标准格式或未知格式

**排查**：
1. 检查Excel文件是否包含必需列：
   - 商品类目ID
   - 商品名称
   - 价格
2. 检查列名是否完全匹配（区分大小写）
3. 查看后端日志：`FormatDetector` 的输出

### 问题2：所有数据验证失败
**症状**：预览时显示所有行都有错误

**排查**：
1. 检查类目ID列的数据格式
   - 必须是10位数字（如：200005319）
   - 不能包含字母或特殊字符
2. 检查价格列的数据
   - 必须是数字
   - 必须 >0 且 ≤99999.99
3. 检查商品名称列
   - 不能为空
   - 长度不能超过255字符

### 问题3：预览或导入超时
**症状**：长时间无响应或超时错误

**排查**：
1. 检查文件大小（建议 <10MB）
2. 检查数据行数（建议 <5000行）
3. 查看后端日志是否有异常
4. 检查数据库连接是否正常

### 问题4：错误信息不详细
**症状**：只显示"导入失败"，没有详细错误

**排查**：
1. 检查浏览器控制台（F12）是否有错误
2. 查看后端日志获取详细错误信息
3. 检查网络请求的响应内容

## 📝 测试报告模板

### 测试环境
- 操作系统：Windows
- 浏览器：Chrome/Edge
- 后端版本：Spring Boot 3.x
- 前端版本：Vue 3 + Vite

### 测试结果
| 测试项 | 预期结果 | 实际结果 | 状态 | 备注 |
|--------|----------|----------|------|------|
| 格式识别 | 识别为美团格式 | | ✅/❌ | |
| 数据预览 | 显示前20行 | | ✅/❌ | |
| 错误报告 | 显示详细错误 | | ✅/❌ | |
| 数据导入 | 成功导入有效数据 | | ✅/❌ | |
| 性能测试 | 3752行<30秒 | | ✅/❌ | |

### 发现的问题
1. 
2. 
3. 

### 改进建议
1. 
2. 
3. 

## 🎉 测试成功标准

所有以下条件都满足：
- ✅ 美团格式能正确识别
- ✅ 数据能正确解析和映射
- ✅ 错误报告详细准确
- ✅ 预览功能正常
- ✅ 导入功能正常
- ✅ 性能满足要求（3752行<30秒）
- ✅ 标准格式仍然兼容

## 📞 需要帮助？

如果测试过程中遇到问题：
1. 查看浏览器控制台（F12）
2. 查看后端日志
3. 检查 `MEITUAN_FORMAT_AUTO_IMPORT_PROGRESS.md` 了解实现细节
4. 检查 `TROUBLESHOOTING.md` 查看常见问题解决方案

---

**准备好了吗？开始测试吧！** 🚀
