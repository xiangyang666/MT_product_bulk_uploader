# 开发者工具密码功能 - 使用说明

## 功能概述

为了增强系统安全性，添加了开发者工具密码保护功能。只有 `admin-plus` 账号可以设置这个密码，用户需要输入正确的密码才能打开开发者工具（F12）。

## 功能特性

1. **密码设置**：只有 admin-plus 账号可以设置/修改开发者工具密码
2. **密码加密**：密码使用 BCrypt 加密存储在数据库中
3. **密码验证**：用户打开开发者工具时需要验证密码
4. **安全存储**：密码存储在独立的配置表中

## 数据库结构

### dev_tools_config 表

| 字段 | 类型 | 说明 |
|------|------|------|
| id | BIGINT | 主键ID |
| config_key | VARCHAR(100) | 配置键（dev_tools_password） |
| config_value | VARCHAR(500) | 配置值（BCrypt加密的密码） |
| description | VARCHAR(200) | 配置描述 |
| created_at | DATETIME | 创建时间 |
| updated_at | DATETIME | 更新时间 |
| created_by | VARCHAR(50) | 创建人 |
| updated_by | VARCHAR(50) | 更新人 |

## 后端 API

### 1. 设置开发者工具密码

**接口**: `POST /api/dev-tools/password`

**权限**: 只有 admin-plus 可以调用

**请求体**:
```json
{
  "password": "your_password"
}
```

**响应**:
```json
{
  "code": 200,
  "message": "开发者工具密码设置成功",
  "data": null
}
```

### 2. 验证开发者工具密码

**接口**: `POST /api/dev-tools/password/verify`

**权限**: 所有登录用户

**请求体**:
```json
{
  "password": "your_password"
}
```

**响应**:
```json
{
  "code": 200,
  "message": "密码验证通过",
  "data": {
    "valid": true
  }
}
```

### 3. 获取密码设置状态

**接口**: `GET /api/dev-tools/password/status`

**权限**: 所有登录用户

**响应**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "hasPassword": true
  }
}
```

## 前端使用

### 1. 设置密码（admin-plus）

1. 使用 admin-plus 账号登录
2. 进入"成员管理"页面
3. 点击"开发者工具设置"按钮
4. 输入新密码（至少6个字符）
5. 确认密码
6. 点击"确定"保存
7. 系统自动启用开发者工具保护

### 2. 验证密码（所有用户）

当用户尝试打开开发者工具时：

1. 系统检测到 F12、Ctrl+Shift+I/J/C/D 等快捷键
2. 弹出密码输入对话框
3. 用户输入密码
4. 系统调用验证 API
5. 验证通过则临时禁用保护（3秒）
6. 提示用户再次按快捷键打开开发者工具
7. 3秒后自动重新启用保护
8. 验证失败则继续阻止打开

### 3. 支持的快捷键拦截

- F12
- Ctrl+Shift+I (Windows/Linux) / Cmd+Option+I (Mac)
- Ctrl+Shift+J (Windows/Linux) / Cmd+Option+J (Mac)
- Ctrl+Shift+C (Windows/Linux) / Cmd+Option+C (Mac)
- Ctrl+Shift+D (Windows/Linux) / Cmd+Option+D (Mac) - 自定义开发者工具快捷键

## 部署步骤

### 1. 数据库迁移

```bash
# 执行数据库迁移脚本
mysql -u root -p meituan_product < database-migration-dev-tools-password.sql
```

### 2. 后端部署

```bash
cd meituan-backend
mvn clean package -DskipTests
# 重启后端服务
```

### 3. 前端部署

```bash
cd meituan-frontend
npm run build
# 部署 dist 目录到服务器
```

## 使用流程

### 首次设置

1. **admin-plus 登录**
   ```
   用户名: admin-plus
   密码: [admin-plus的密码]
   ```

2. **进入成员管理**
   - 点击左侧菜单"成员管理"

3. **设置开发者工具密码**
   - 点击"开发者工具设置"按钮
   - 输入密码（例如：dev123456）
   - 确认密码
   - 点击"确定"

4. **验证设置**
   - 设置成功后会显示提示消息
   - 密码已加密存储在数据库中

### 修改密码

1. 使用 admin-plus 账号登录
2. 进入"成员管理"页面
3. 点击"开发者工具设置"按钮
4. 输入新密码
5. 确认新密码
6. 点击"确定"保存

### 用户使用

1. 用户尝试打开开发者工具（F12）
2. 系统弹出密码输入框
3. 输入开发者工具密码
4. 验证通过后可以使用开发者工具

## 安全建议

1. **定期更换密码**：建议每3-6个月更换一次开发者工具密码
2. **密码强度**：使用至少6个字符，包含字母和数字
3. **权限控制**：只有 admin-plus 可以设置密码，确保账号安全
4. **日志记录**：所有密码设置和验证操作都会记录日志

## 常见问题

### Q1: 忘记开发者工具密码怎么办？
A: 使用 admin-plus 账号登录，重新设置新密码即可。

### Q2: 可以禁用开发者工具密码保护吗？
A: 目前不支持禁用。如果需要临时允许所有人访问，可以设置一个简单的密码并告知团队成员。

### Q3: 密码存储安全吗？
A: 是的，密码使用 BCrypt 加密算法存储，即使数据库泄露也无法直接获取明文密码。

### Q4: 其他超级管理员可以设置密码吗？
A: 不可以，只有 admin-plus 账号才能设置开发者工具密码。

### Q5: 如何查看当前是否已设置密码？
A: 可以调用 `GET /api/dev-tools/password/status` 接口查看设置状态。

## 技术实现

### 后端

- **实体类**: `DevToolsConfig.java`
- **Mapper**: `DevToolsConfigMapper.java`
- **Service**: `DevToolsService.java`
- **Controller**: `DevToolsController.java`
- **DTO**: `DevToolsPasswordRequest.java`, `DevToolsPasswordVerifyRequest.java`

### 前端

- **API**: `src/api/devTools.js`
- **保护模块**: `src/utils/devToolsProtection.js`
- **页面**: `src/views/MemberManagement.vue`（添加设置入口）
- **应用入口**: `src/App.vue`（初始化保护）
- **组件**: 开发者工具设置对话框

### 数据库

- **表**: `dev_tools_config`
- **迁移脚本**: `database-migration-dev-tools-password.sql`

## 文件清单

### 新增文件

**后端**:
- `meituan-backend/src/main/java/com/meituan/product/entity/DevToolsConfig.java`
- `meituan-backend/src/main/java/com/meituan/product/mapper/DevToolsConfigMapper.java`
- `meituan-backend/src/main/java/com/meituan/product/service/DevToolsService.java`
- `meituan-backend/src/main/java/com/meituan/product/controller/DevToolsController.java`
- `meituan-backend/src/main/java/com/meituan/product/dto/DevToolsPasswordRequest.java`
- `meituan-backend/src/main/java/com/meituan/product/dto/DevToolsPasswordVerifyRequest.java`

**前端**:
- `meituan-frontend/src/api/devTools.js`
- `meituan-frontend/src/utils/devToolsProtection.js`

**数据库**:
- `database-migration-dev-tools-password.sql`

### 修改文件

**前端**:
- `meituan-frontend/src/views/MemberManagement.vue`（添加设置入口和对话框）
- `meituan-frontend/src/App.vue`（初始化开发者工具保护）

## 总结

开发者工具密码功能已完整实现，包括：

1. ✅ 数据库表结构设计
2. ✅ 后端 API 实现（设置、验证、查询状态）
3. ✅ 前端设置界面（只对 admin-plus 显示）
4. ✅ 密码加密存储（BCrypt）
5. ✅ 权限控制（只有 admin-plus 可以设置）
6. ✅ 前端拦截逻辑（F12、快捷键、右键菜单）
7. ✅ 密码验证流程（弹窗输入、API验证、临时解锁）
8. ✅ 自动保护启用（设置密码后自动启用）

功能已完全实现，可以部署使用。
