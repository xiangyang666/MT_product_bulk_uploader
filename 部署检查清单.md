# 🚀 部署检查清单

## 📋 后端部署检查

### 1. 服务器环境
- [ ] JRE 17 已安装
- [ ] MySQL 数据库可访问
- [ ] MinIO 服务可访问（如果使用）

### 2. 数据库配置
- [ ] 数据库 `meituan_product` 已创建
- [ ] 数据库表已初始化
- [ ] 用户表有 `created_by` 和 `updated_by` 字段
- [ ] admin 用户角色为 `SUPER_ADMIN`

### 3. 防火墙配置 ⚠️ **重要**
- [ ] **8080 端口已开放**（后端 API）
- [ ] 3306 端口已开放（MySQL，如果远程访问）
- [ ] 9000 端口已开放（MinIO API，如果使用）
- [ ] 9001 端口已开放（MinIO 控制台，如果使用）

### 4. 后端服务
- [ ] `app.jar` 已上传到服务器
- [ ] 后端服务已启动
- [ ] 日志显示启动成功
- [ ] 可以访问健康检查接口

### 5. CORS 配置
- [ ] WebConfig 已配置 `allowedOriginPatterns("*")`
- [ ] 允许的方法包含：GET, POST, PUT, DELETE, OPTIONS
- [ ] `allowCredentials(true)` 已设置

---

## 📋 前端部署检查

### 1. 环境配置
- [ ] `.env.development` 文件存在
- [ ] `.env.production` 文件存在
- [ ] API 地址配置正确

### 2. 开发环境
- [ ] Node.js 已安装
- [ ] 依赖已安装（`npm install`）
- [ ] 开发服务器可以启动（`npm run dev`）
- [ ] Vite 代理配置正确

### 3. 生产打包
- [ ] 打包命令执行成功
- [ ] 安装包已生成
- [ ] 安装包可以正常安装
- [ ] 应用可以正常启动

---

## 🧪 连接测试

### 测试后端 API
```bash
# 测试远程后端
curl http://106.55.102.48:8080/api/products/stats?merchantId=1

# 应该返回 JSON 数据，而不是连接错误
```

### 测试防火墙
```bash
# 测试端口是否开放
telnet 106.55.102.48 8080

# 或使用 nc
nc -zv 106.55.102.48 8080
```

### 测试 CORS
在浏览器控制台执行：
```javascript
fetch('http://106.55.102.48:8080/api/products/stats?merchantId=1')
  .then(res => res.json())
  .then(data => console.log('成功:', data))
  .catch(err => console.error('失败:', err))
```

---

## 🐛 常见问题排查

### 问题 1: 连接超时 / Failed to fetch
**可能原因：**
- ❌ 防火墙端口未开放
- ❌ 后端服务未启动
- ❌ 网络不通

**解决方案：**
1. 检查防火墙规则
2. 检查后端服务状态
3. 使用 `telnet` 或 `curl` 测试连接

### 问题 2: CORS 错误
**可能原因：**
- ❌ 后端 CORS 配置不正确
- ❌ 使用了旧版本的后端代码

**解决方案：**
1. 检查 `WebConfig.java` 配置
2. 重新打包部署后端
3. 清除浏览器缓存

### 问题 3: 401 未授权
**可能原因：**
- ❌ Spring Security 拦截了请求
- ❌ Token 过期或无效

**解决方案：**
1. 检查 Security 配置
2. 确认 API 路径是否需要认证
3. 检查 Token 是否正确

### 问题 4: 数据库连接失败
**可能原因：**
- ❌ 数据库服务未启动
- ❌ 连接信息配置错误
- ❌ 防火墙阻止数据库端口

**解决方案：**
1. 检查数据库服务状态
2. 验证 `application.yml` 配置
3. 测试数据库连接

---

## 📝 部署命令速查

### 后端部署
```bash
# 1. 打包
cd meituan-backend
mvn clean package -Dmaven.test.skip=true

# 2. 上传到服务器
scp target/app.jar user@106.55.102.48:/opt/app/

# 3. 启动服务
ssh user@106.55.102.48
cd /opt/app
nohup java -jar app.jar > app.log 2>&1 &
echo $! > app.pid

# 4. 查看日志
tail -f app.log

# 5. 停止服务
kill $(cat app.pid)
```

### 前端打包
```bash
# 1. 打包 Electron 应用
cd meituan-frontend
npm run electron:build:win

# 2. 安装包位置
# meituan-frontend/dist-electron/美团商品上传工具-1.0.0-x64.exe
```

---

## ✅ 部署成功标志

### 后端
- [ ] 服务启动日志显示 "Started ProductUploadApplication"
- [ ] 可以访问 `http://106.55.102.48:8080/api/products/stats`
- [ ] 返回正确的 JSON 数据

### 前端
- [ ] 开发模式可以正常访问后端
- [ ] 打包后的应用可以正常安装
- [ ] 应用可以正常加载数据

---

## 🔒 安全建议

### 生产环境
- [ ] 修改默认密码
- [ ] 配置 HTTPS
- [ ] 限制 CORS 允许的来源
- [ ] 配置防火墙白名单
- [ ] 定期备份数据库
- [ ] 配置日志轮转

### 开发环境
- [ ] 不要在代码中硬编码密码
- [ ] 使用环境变量管理敏感信息
- [ ] 定期更新依赖包

---

**记住：部署前先检查防火墙端口！** 🔥
