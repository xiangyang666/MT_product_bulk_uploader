# 商品表格固定表头 - 实现说明

## 功能描述

为商品管理页面的表格添加固定表头功能，使用户在滚动查看商品数据时，表头始终保持可见。

## 实现方案

### 1. 使用 Element Plus 表格的 height 属性

Element Plus 的 `el-table` 组件提供了 `height` 属性，设置后会自动启用固定表头功能。

**修改内容**:
```vue
<el-table
  :data="products"
  style="width: 100%"
  v-loading="loading"
  @selection-change="handleSelectionChange"
  height="650"
  ref="tableRef"
>
```

### 2. 调整容器样式

移除外层容器的滚动和高度限制，因为表格本身会处理滚动：

**修改前**:
```css
.table-card {
  background-color: white;
  border-radius: 12px;
  padding: 16px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  margin-bottom: 16px;
  max-height: 700px;
  overflow-y: auto;
}
```

**修改后**:
```css
.table-card {
  background-color: white;
  border-radius: 12px;
  padding: 16px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  margin-bottom: 16px;
}
```

### 3. 更新滚动监听逻辑

由于滚动容器从外层 div 变为表格内部，需要更新滚动事件监听：

**修改前**:
```vue
<div class="table-card" ref="tableCardRef" @scroll="handleScroll">
```

**修改后**:
```vue
<div class="table-card">
  <el-table ref="tableRef" ...>
```

在 `onMounted` 中监听表格内部滚动：
```javascript
onMounted(async () => {
  selectToday()
  
  // 等待 DOM 渲染完成后监听表格内部滚动
  await nextTick()
  
  if (tableRef.value) {
    const tableBody = tableRef.value.$el.querySelector('.el-table__body-wrapper')
    if (tableBody) {
      tableBody.addEventListener('scroll', (event) => {
        const { scrollTop, scrollHeight, clientHeight } = event.target
        
        // 滚动到底部时加载更多（提前50px触发）
        if (scrollTop + clientHeight >= scrollHeight - 50 && hasMore.value && !loadingMore.value && !loading.value) {
          currentPage.value++
          fetchProducts(true)
        }
      })
    }
  }
})
```

### 4. 移除旧的滚动处理函数

删除了 `handleScroll` 函数，因为滚动监听已经直接在 `onMounted` 中实现。

## 技术细节

### Element Plus 表格固定表头原理

当设置 `height` 属性后，Element Plus 会：
1. 将表格分为表头和表体两个独立的滚动区域
2. 表头固定在顶部，不参与滚动
3. 表体可以独立滚动
4. 自动处理列宽对齐

### 滚动容器选择器

表格内部的滚动容器是 `.el-table__body-wrapper`，这是 Element Plus 表格组件的内部结构。

### 使用 nextTick 的原因

`nextTick` 确保在 Vue 完成 DOM 更新后再访问表格元素，避免获取不到 DOM 元素的问题。

## 功能特性

1. **固定表头**: 滚动时表头始终可见
2. **固定列**: 序号、选择框、操作列等关键列固定在左右两侧
3. **无限滚动**: 保持原有的滚动加载更多功能
4. **响应式高度**: 表格高度固定为 650px，适配大多数屏幕

## 用户体验改进

- ✅ 滚动查看大量商品时，表头始终可见，方便对照字段
- ✅ 固定的序号和操作列，方便快速定位和操作
- ✅ 流畅的滚动体验，无卡顿
- ✅ 保持原有的无限滚动加载功能

## 相关文件

- `meituan-frontend/src/views/Products.vue` - 商品管理页面（已修改）

## 测试建议

1. 导入大量商品数据（100+条）
2. 滚动表格，验证表头是否固定
3. 滚动到底部，验证是否自动加载更多数据
4. 检查固定列（序号、操作）是否正常工作
5. 测试不同屏幕尺寸下的显示效果

## 可选优化

如果需要动态调整表格高度以适应不同屏幕：

```javascript
const tableHeight = ref(650)

onMounted(() => {
  // 根据窗口高度动态计算表格高度
  const windowHeight = window.innerHeight
  tableHeight.value = windowHeight - 300 // 减去其他元素的高度
})
```

然后在模板中使用：
```vue
<el-table :height="tableHeight" ...>
```
