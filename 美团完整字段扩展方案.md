# 美团商品完整字段扩展方案

## 📋 需求概述

### 1. 功能需求
- ✅ 商品管理页面添加删除功能（批量删除 + 单个删除）
- ✅ 扩展数据库支持美团完整的50+个商品字段
- ✅ 批量导入时支持所有字段的导入

### 2. 新增字段列表

#### 基础信息字段
- `sku_id` - SKU ID
- `upc_ean` - 条形码(upc/ean等)
- `category_name` - 商品类目名称
- `category_id` - 商品类目ID（已有）
- `app_spu_code` - APP SPU编码
- `product_name` - 商品名称（已有）

#### 图片视频字段
- `product_image` - 商品图片
- `cover_video` - 封面视频
- `spec_image` - 规格图
- `spec_image_url` - 规格图URL

#### 分类库存字段
- `store_category` - 店内分类
- `store_category_count` - 所处店内分类数量
- `spec_name` - 规格名称
- `store_code` - 店内码/货号
- `price` - 价格（已有）
- `stock` - 库存（已有）
- `sale_status` - 售卖状态
- `monthly_sales` - 月售
- `weight` - 重量
- `weight_unit` - 重量单位
- `min_purchase` - 起购数
- `shelf_code` - 货架码/位置码

#### 详情描述字段
- `selling_point` - 商品卖点
- `selling_point_period` - 卖点展示期
- `text_detail` - 文字详情
- `image_detail` - 图片详情
- `brand_image_detail` - 品牌商图片详情

#### 日期相关字段
- `production_date` - 生产日期
- `expiry_date` - 到期日期
- `is_near_expiry` - 是否临期
- `is_expired` - 是否过期

#### 配送时间字段
- `delivery_mode` - 发货模式
- `presale_delivery_time` - 预售的可配送时间
- `available_time` - 可售时间

#### 商品属性字段
- `product_attributes` - 商品属性
- `is_recommended` - 力荐
- `no_reason_return` - 无理由退货
- `is_combo` - 组合商品
- `combo_products` - 参与的组合商品
- `is_four_wheel_delivery` - 是否四轮配送

#### 合规审核字段
- `compliance_status` - 合规状态
- `violation_offline` - 违规下架
- `missing_required_info` - 必填信息缺失
- `audit_status` - 审核状态

---

## 🗄️ 数据库扩展方案

### 方案选择

考虑到字段数量较多（50+个），有两种方案：

#### 方案A：单表扩展（推荐）
**优点：**
- 查询简单，性能好
- 不需要JOIN操作
- 适合大部分字段都会使用的场景

**缺点：**
- 表字段较多
- 单行数据较大

#### 方案B：主表+扩展表
**优点：**
- 主表保持简洁
- 扩展字段独立管理

**缺点：**
- 需要JOIN查询
- 性能略低
- 维护复杂

**建议：采用方案A（单表扩展）**

---

## 📝 实施步骤

### 步骤1：数据库迁移脚本

创建 `database-migration-full-fields.sql`

### 步骤2：更新Product实体类

添加所有新字段的属性和getter/setter

### 步骤3：更新FormatDetector

添加所有新字段的列名映射

### 步骤4：更新MeituanFormatParser

支持解析所有新字段

### 步骤5：更新ExcelService

支持导入和导出所有字段

### 步骤6：添加删除功能

#### 后端：
- `ProductController.deleteProduct(id)` - 单个删除
- `ProductController.batchDeleteProducts(ids)` - 批量删除

#### 前端：
- Products.vue 添加删除按钮
- 添加批量选择功能
- 添加批量删除按钮

### 步骤7：更新商品管理页面

- 添加更多列显示
- 添加列筛选功能
- 添加导出功能

---

## ⚠️ 注意事项

### 1. 数据迁移
- 执行迁移脚本前先备份数据
- 新字段设置合理的默认值
- 考虑现有数据的兼容性

### 2. 性能优化
- 为常用查询字段添加索引
- 考虑分页查询的性能
- 大字段（TEXT）考虑延迟加载

### 3. 前端展示
- 字段太多，考虑分组展示
- 使用折叠面板或标签页
- 提供字段显示/隐藏配置

### 4. 导入导出
- Excel列数限制（最多16384列）
- 考虑分批导入大文件
- 提供导入模板下载

---

## 🚀 快速开始

### 1. 执行数据库迁移
```sql
source database-migration-full-fields.sql
```

### 2. 重启后端服务
```bash
cd meituan-backend
mvn clean package
java -jar target/meituan-product-backend.jar
```

### 3. 重启前端服务
```bash
cd meituan-frontend
npm run dev
```

---

## 📊 字段映射表

| 美团字段名 | 数据库字段名 | 数据类型 | 说明 |
|---|---|---|---|
| SKU ID | sku_id | VARCHAR(50) | SKU唯一标识 |
| 条形码(upc/ean等) | upc_ean | VARCHAR(50) | 商品条形码 |
| 商品类目名称 | category_name | VARCHAR(100) | 类目名称 |
| 商品类目ID | category_id | VARCHAR(100) | 类目ID |
| app_spu_code | app_spu_code | VARCHAR(50) | SPU编码 |
| 商品名称 | product_name | VARCHAR(255) | 商品名称 |
| 商品图片 | product_image | VARCHAR(500) | 图片URL |
| 封面视频 | cover_video | VARCHAR(500) | 视频URL |
| 店内分类 | store_category | VARCHAR(100) | 店内分类 |
| 所处店内分类数量 | store_category_count | INT | 分类数量 |
| 规格名称 | spec_name | VARCHAR(100) | 规格名称 |
| 规格图 | spec_image | VARCHAR(500) | 规格图URL |
| 规格图url | spec_image_url | VARCHAR(500) | 规格图URL |
| 店内码/货号 | store_code | VARCHAR(50) | 店内码 |
| 价格 | price | DECIMAL(10,2) | 价格 |
| 库存 | stock | INT | 库存数量 |
| 售卖状态 | sale_status | VARCHAR(20) | 售卖状态 |
| 月售 | monthly_sales | INT | 月销量 |
| 重量 | weight | DECIMAL(10,2) | 重量 |
| 重量单位 | weight_unit | VARCHAR(10) | 单位 |
| 起购数 | min_purchase | INT | 最小购买数 |
| 货架码/位置码 | shelf_code | VARCHAR(50) | 货架码 |
| 创建时间 | created_time | DATETIME | 创建时间 |
| 商品卖点 | selling_point | TEXT | 卖点描述 |
| 卖点展示期 | selling_point_period | VARCHAR(50) | 展示期 |
| 文字详情 | text_detail | TEXT | 文字详情 |
| 图片详情 | image_detail | TEXT | 图片详情 |
| 品牌商图片详情 | brand_image_detail | TEXT | 品牌图片 |
| 生产日期 | production_date | DATE | 生产日期 |
| 到期日期 | expiry_date | DATE | 到期日期 |
| 是否临期 | is_near_expiry | TINYINT | 0否1是 |
| 是否过期 | is_expired | TINYINT | 0否1是 |
| 发货模式 | delivery_mode | VARCHAR(20) | 发货模式 |
| 预售的可配送时间 | presale_delivery_time | VARCHAR(100) | 配送时间 |
| 可售时间 | available_time | VARCHAR(100) | 可售时间 |
| 商品属性 | product_attributes | TEXT | 商品属性JSON |
| 力荐 | is_recommended | TINYINT | 0否1是 |
| 无理由退货 | no_reason_return | TINYINT | 0否1是 |
| 组合商品 | is_combo | TINYINT | 0否1是 |
| 参与的组合商品 | combo_products | TEXT | 组合商品列表 |
| 是否四轮配送 | is_four_wheel_delivery | TINYINT | 0否1是 |
| 合规状态 | compliance_status | VARCHAR(20) | 合规状态 |
| 违规下架 | violation_offline | TINYINT | 0否1是 |
| 必填信息缺失 | missing_required_info | TINYINT | 0否1是 |
| 审核状态 | audit_status | VARCHAR(20) | 审核状态 |

---

## 📅 开发计划

### 第一阶段：数据库扩展（1天）
- [x] 设计数据库表结构
- [ ] 编写迁移脚本
- [ ] 测试迁移脚本
- [ ] 执行数据迁移

### 第二阶段：后端开发（2天）
- [ ] 更新Product实体类
- [ ] 更新FormatDetector
- [ ] 更新MeituanFormatParser
- [ ] 更新ExcelService
- [ ] 添加删除接口
- [ ] 单元测试

### 第三阶段：前端开发（2天）
- [ ] 更新Products.vue
- [ ] 添加删除功能
- [ ] 添加批量选择
- [ ] 优化表格显示
- [ ] 测试功能

### 第四阶段：测试上线（1天）
- [ ] 集成测试
- [ ] 性能测试
- [ ] 用户验收测试
- [ ] 部署上线

---

**预计总工期：6天**

**创建时间：2026-02-09**
**状态：待实施**
