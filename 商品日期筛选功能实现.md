# 商品日期筛选功能实现

## 功能概述

为商品管理页面添加日期筛选功能，实现以下需求：
1. 区分每天导入的商品
2. 通过日期范围查看以往导入的商品数据
3. 突出显示今日导入的商品

## 实现内容

### 1. 前端功能（meituan-frontend/src/views/Products.vue）

#### 1.1 添加日期选择器

在搜索栏添加日期范围选择器：

```vue
<el-date-picker
  v-model="dateRange"
  type="daterange"
  range-separator="至"
  start-placeholder="开始日期"
  end-placeholder="结束日期"
  format="YYYY-MM-DD"
  value-format="YYYY-MM-DD"
  @change="handleSearch"
  clearable
  style="width: 280px;"
/>
```

**特性**：
- 支持选择日期范围
- 格式：YYYY-MM-DD
- 可清空，清空后显示所有商品
- 选择日期后自动触发搜索

#### 1.2 优化导入时间显示

将"创建时间"列改为"导入时间"，并优化显示格式：

```vue
<el-table-column prop="createdTime" label="导入时间" width="160" fixed="right">
  <template #default="scope">
    <div :class="{ 'today-import': isToday(scope.row.createdTime) }">
      <div style="font-weight: 600;">{{ formatDate(scope.row.createdTime) }}</div>
      <div style="font-size: 12px; color: #909399;">{{ formatTime(scope.row.createdTime) }}</div>
    </div>
  </template>
</el-table-column>
```

**显示效果**：
- 第一行：日期（YYYY-MM-DD）- 加粗显示
- 第二行：时间（HH:mm:ss）- 灰色小字
- 今日导入：黄色背景高亮 + 左侧黄色边框

#### 1.3 添加日期格式化函数

```javascript
// 格式化日期（YYYY-MM-DD）
const formatDate = (dateTime) => {
  if (!dateTime) return '-'
  const date = new Date(dateTime)
  const year = date.getFullYear()
  const month = String(date.getMonth() + 1).padStart(2, '0')
  const day = String(date.getDate()).padStart(2, '0')
  return `${year}-${month}-${day}`
}

// 格式化时间（HH:mm:ss）
const formatTime = (dateTime) => {
  if (!dateTime) return '-'
  const date = new Date(dateTime)
  const hours = String(date.getHours()).padStart(2, '0')
  const minutes = String(date.getMinutes()).padStart(2, '0')
  const seconds = String(date.getSeconds()).padStart(2, '0')
  return `${hours}:${minutes}:${seconds}`
}

// 判断是否为今天导入
const isToday = (dateTime) => {
  if (!dateTime) return false
  const date = new Date(dateTime)
  const today = new Date()
  return date.getFullYear() === today.getFullYear() &&
         date.getMonth() === today.getMonth() &&
         date.getDate() === today.getDate()
}
```

#### 1.4 更新API请求

在 `fetchProducts` 函数中添加日期范围参数：

```javascript
const params = {
  page: currentPage.value,
  size: pageSize.value,
  keyword: searchQuery.value
}

// 添加日期范围参数
if (dateRange.value && dateRange.value.length === 2) {
  params.startDate = dateRange.value[0]
  params.endDate = dateRange.value[1]
}

const response = await request.get('/products', { params })
```

#### 1.5 添加样式

```css
/* 今日导入高亮 */
.today-import {
  padding: 4px 8px;
  background-color: #fff7e6;
  border-radius: 4px;
  border-left: 3px solid #FFD100;
}
```

### 2. 后端功能（meituan-backend/.../ProductController.java）

#### 2.1 更新API接口

添加日期范围参数：

```java
@GetMapping
public ApiResponse<Map<String, Object>> getProducts(
        @RequestParam(value = "page", required = false, defaultValue = "1") Integer page,
        @RequestParam(value = "size", required = false, defaultValue = "20") Integer size,
        @RequestParam(value = "keyword", required = false) String keyword,
        @RequestParam(value = "startDate", required = false) String startDate,
        @RequestParam(value = "endDate", required = false) String endDate)
```

#### 2.2 实现日期筛选逻辑

```java
// 如果有日期范围，进行过滤
if (startDate != null && endDate != null) {
    try {
        LocalDateTime startDateTime = LocalDateTime.parse(startDate + "T00:00:00");
        LocalDateTime endDateTime = LocalDateTime.parse(endDate + "T23:59:59");
        
        allProducts = allProducts.stream()
            .filter(p -> {
                if (p.getCreatedTime() == null) return false;
                return !p.getCreatedTime().isBefore(startDateTime) && 
                       !p.getCreatedTime().isAfter(endDateTime);
            })
            .collect(Collectors.toList());
        
        log.info("日期筛选后商品数量：{}", allProducts.size());
    } catch (Exception e) {
        log.error("日期解析失败", e);
    }
}
```

**筛选逻辑**：
- 将日期字符串转换为 LocalDateTime
- 开始时间：00:00:00
- 结束时间：23:59:59
- 过滤 createdTime 在范围内的商品

## 使用说明

### 1. 查看今日导入的商品

**方法一：通过高亮识别**
- 打开商品管理页面
- 今日导入的商品会有黄色背景高亮显示
- 导入时间列会有黄色左边框

**方法二：通过日期筛选**
- 点击日期选择器
- 选择今天的日期作为开始和结束日期
- 自动筛选出今日导入的商品

### 2. 查看指定日期范围的商品

1. 点击日期选择器
2. 选择开始日期和结束日期
3. 系统自动筛选该日期范围内导入的商品
4. 可以配合关键词搜索使用

### 3. 查看所有商品

- 点击日期选择器的清空按钮（×）
- 或者不选择日期
- 显示所有商品

## 功能特点

### 1. 视觉区分

- ✅ 今日导入商品：黄色背景 + 左侧黄色边框
- ✅ 历史导入商品：普通白色背景
- ✅ 导入时间：日期 + 时间分开显示，更清晰

### 2. 灵活筛选

- ✅ 支持单日查询（开始和结束日期相同）
- ✅ 支持日期范围查询
- ✅ 支持日期 + 关键词组合查询
- ✅ 可清空日期筛选，恢复显示所有商品

### 3. 性能优化

- ✅ 前端日期选择器自动触发搜索
- ✅ 后端使用 Stream API 高效过滤
- ✅ 日期解析异常处理，不影响其他功能

## API 接口说明

### 请求示例

```http
GET /api/products?page=1&size=20&startDate=2026-02-15&endDate=2026-02-15
```

### 参数说明

| 参数 | 类型 | 必填 | 说明 | 示例 |
|------|------|------|------|------|
| page | Integer | 否 | 页码，默认1 | 1 |
| size | Integer | 否 | 每页大小，默认20 | 20 |
| keyword | String | 否 | 搜索关键词 | "苹果" |
| startDate | String | 否 | 开始日期 | "2026-02-15" |
| endDate | String | 否 | 结束日期 | "2026-02-15" |

### 响应示例

```json
{
  "code": 200,
  "message": "操作成功",
  "data": {
    "list": [
      {
        "id": 1,
        "productName": "苹果 iPhone 15 Pro",
        "categoryId": "2000010001",
        "price": 7999.00,
        "createdTime": "2026-02-15T10:30:25",
        ...
      }
    ],
    "total": 24,
    "page": 1,
    "size": 20
  }
}
```

## 测试场景

### 场景1：查看今日导入

1. 今天导入一批商品
2. 打开商品管理页面
3. **预期结果**：今日导入的商品有黄色背景高亮

### 场景2：按日期筛选

1. 选择日期范围：2026-02-10 至 2026-02-15
2. 点击搜索或自动触发
3. **预期结果**：只显示该日期范围内导入的商品

### 场景3：组合查询

1. 选择日期范围：2026-02-15 至 2026-02-15
2. 输入关键词："苹果"
3. 点击搜索
4. **预期结果**：显示今天导入的包含"苹果"的商品

### 场景4：清空筛选

1. 已选择日期范围
2. 点击日期选择器的清空按钮
3. **预期结果**：显示所有商品

## 数据库字段

使用现有的 `created_time` 字段：

```sql
CREATE TABLE t_product (
  ...
  created_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  ...
);
```

- 类型：DATETIME
- 默认值：CURRENT_TIMESTAMP（插入时自动设置）
- 用途：记录商品导入时间

## 注意事项

1. **时区问题**：确保前后端时区一致
2. **日期格式**：统一使用 YYYY-MM-DD 格式
3. **时间范围**：结束日期自动设置为 23:59:59，包含当天全天
4. **性能考虑**：大量数据时建议在数据库层面添加日期索引
5. **空值处理**：如果 createdTime 为空，不会被筛选出来

## 未来优化建议

1. **快捷日期选择**：添加"今天"、"昨天"、"最近7天"等快捷按钮
2. **数据库索引**：为 created_time 字段添加索引，提升查询性能
3. **导出功能**：支持导出指定日期范围的商品数据
4. **统计图表**：添加每日导入数量的趋势图
5. **批量操作**：支持按日期批量删除或修改商品

## 修改文件清单

- ✅ `meituan-frontend/src/views/Products.vue`
  - 添加日期选择器
  - 优化导入时间显示
  - 添加今日导入高亮样式
  - 添加日期格式化函数
  - 更新API请求参数

- ✅ `meituan-backend/src/main/java/com/meituan/product/controller/ProductController.java`
  - 添加 startDate 和 endDate 参数
  - 实现日期范围筛选逻辑
  - 添加日志记录

## 完成状态

✅ 功能已完成
- 日期选择器已添加
- 今日导入商品高亮显示
- 日期范围筛选功能正常
- 前后端联调通过
