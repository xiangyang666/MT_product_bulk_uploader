# 需求文档 - 美团格式自动识别导入

## 简介

用户从美团后台导出的商品数据包含50+列，系统应该能够智能识别美团格式并自动提取所需字段进行导入，而不需要用户手动转换数据格式。

## 术语表

- **美团导出格式**：美团后台导出的商品数据文件，包含50+列的完整商品信息
- **系统导入格式**：系统内部使用的简化格式，只包含6个核心字段
- **智能识别**：系统自动检测文件是否为美团格式，并自动提取所需字段
- **字段映射**：将美团格式的列名映射到系统格式的字段名

## 需求

### 需求 1：智能识别美团格式

**用户故事**：作为商家，我想直接上传从美团后台导出的Excel文件，系统能自动识别并导入，这样我就不需要手动转换数据格式。

#### 验收标准

1. WHEN 用户上传包含"商品类目ID"、"商品名称"、"价格"列的Excel文件 THEN 系统应识别为美团格式
2. WHEN 系统识别到美团格式 THEN 系统应自动提取以下字段：
   - 商品名称 ← 商品名称
   - 类目ID ← 商品类目ID
   - 价格 ← 价格
   - 库存 ← 库存
   - 商品描述 ← 文字详情（如果存在）
3. WHEN 系统无法识别为美团格式 THEN 系统应按照标准导入格式处理
4. WHEN 美团格式文件缺少必需列 THEN 系统应返回明确的错误信息，指出缺少哪些列
5. WHEN 美团格式文件包含3000+行数据 THEN 系统应能在30秒内完成解析

### 需求 2：数据验证和转换

**用户故事**：作为商家，我想系统自动验证和转换美团数据，确保数据符合系统要求，这样我就能快速完成导入。

#### 验收标准

1. WHEN 系统提取商品类目ID THEN 系统应验证其为10位数字格式
2. WHEN 商品类目ID不是10位数字 THEN 系统应记录该行错误并继续处理其他行
3. WHEN 系统提取价格 THEN 系统应验证价格大于0且小于等于99999.99
4. WHEN 价格无效 THEN 系统应记录该行错误并继续处理其他行
5. WHEN 系统提取商品名称 THEN 系统应验证名称不为空且长度不超过255字符
6. WHEN 商品名称无效 THEN 系统应记录该行错误并继续处理其他行
7. WHEN 系统提取库存 THEN 系统应将其转换为整数，如果为空则默认为0
8. WHEN 系统提取商品描述 THEN 系统应截取前1000个字符

### 需求 3：详细的错误报告

**用户故事**：作为商家，我想看到详细的错误报告，包括哪些行有问题、具体是什么问题，这样我就能快速修正数据。

#### 验收标准

1. WHEN 导入过程中发现错误 THEN 系统应记录错误的行号、字段名和错误原因
2. WHEN 导入完成 THEN 系统应返回统计信息：总行数、成功行数、失败行数
3. WHEN 存在失败行 THEN 系统应返回前100条错误详情
4. WHEN 错误超过100条 THEN 系统应提示"还有X条错误"
5. WHEN 所有行都失败 THEN 系统应提示可能是文件格式不正确

### 需求 4：预览功能增强

**用户故事**：作为商家，我想在导入前预览数据，确认系统正确识别了美团格式，这样我就能在导入前发现问题。

#### 验收标准

1. WHEN 用户上传美团格式文件进行预览 THEN 系统应显示"已识别为美团格式"提示
2. WHEN 系统识别为美团格式 THEN 预览应显示提取后的6个字段数据
3. WHEN 预览数据 THEN 系统应显示前20行数据
4. WHEN 存在验证错误 THEN 预览应高亮显示错误行和错误字段
5. WHEN 预览完成 THEN 系统应显示"预计可成功导入X行，Y行存在错误"

### 需求 5：兼容性保持

**用户故事**：作为商家，我想系统同时支持美团格式和标准格式，这样我就能灵活选择使用哪种格式。

#### 验收标准

1. WHEN 用户上传标准格式文件 THEN 系统应按原有逻辑处理
2. WHEN 用户上传美团格式文件 THEN 系统应自动切换到美团格式处理逻辑
3. WHEN 系统无法确定文件格式 THEN 系统应尝试标准格式处理
4. WHEN 标准格式处理失败 THEN 系统应返回明确的格式要求说明
5. WHEN 用户下载导入模板 THEN 系统应继续提供标准格式模板

### 需求 6：性能优化

**用户故事**：作为商家，我想快速导入大量数据，即使有3000+行也能在合理时间内完成，这样我就能提高工作效率。

#### 验收标准

1. WHEN 导入3000行数据 THEN 系统应在30秒内完成解析和验证
2. WHEN 导入过程中 THEN 系统应显示进度提示（如"正在处理第X行"）
3. WHEN 导入大文件 THEN 系统应采用流式处理，避免内存溢出
4. WHEN 导入完成 THEN 系统应显示总耗时
5. WHEN 导入失败 THEN 系统应快速失败并返回错误信息，不浪费用户时间

## 非功能性需求

### 性能要求
- 3000行数据解析时间 ≤ 30秒
- 内存使用 ≤ 512MB（处理大文件时）
- 并发支持：至少支持5个用户同时导入

### 可用性要求
- 错误信息清晰易懂，包含具体的行号和字段名
- 支持中文列名识别
- 自动识别准确率 ≥ 99%

### 兼容性要求
- 支持 .xlsx 和 .xls 格式
- 支持 Excel 2007 及以上版本
- 兼容现有的标准格式导入功能

### 可维护性要求
- 字段映射配置化，便于后续调整
- 格式识别逻辑独立，便于扩展其他平台格式
- 完整的日志记录，便于问题排查
