# 🚨 商品表被删除 - 快速恢复指南

## 问题
不小心删除了 `t_product` 表

---

## ✅ 快速恢复（2步）

### 步骤1：执行恢复脚本

**在MySQL客户端中执行：**

```sql
-- 方法A：直接在MySQL客户端中执行
source 重建商品表.sql

-- 或方法B：在命令行中执行
mysql -h 106.55.102.48 -u root -p meituan_product < 重建商品表.sql
```

**或者手动复制粘贴执行：**

打开 `重建商品表.sql` 文件，复制全部内容，粘贴到MySQL客户端执行。

---

### 步骤2：刷新前端并测试

1. **刷新浏览器**（按F5）
2. **进入"批量上传"页面**
3. **应该能看到20个测试商品**
4. **勾选商品并点击"生成模板"**
5. **文件应该自动下载！** 📥

---

## 📊 恢复后的数据

### 表结构
- ✅ `t_product` 表已重建
- ✅ 包含所有必需字段
- ✅ 索引已创建
- ✅ 支持逻辑删除

### 测试数据（20个商品）
- 📱 手机：8个（iPhone, 华为, 小米, OPPO, vivo, 三星, 荣耀, 一加）
- 💻 笔记本：5个（MacBook Pro, MacBook Air, 戴尔, 联想, 华硕）
- 📲 平板：4个（iPad Pro, iPad Air, 华为, 小米）
- 🎧 耳机：3个（AirPods Pro, Sony, Bose）

### 类目ID
- `2000010001` - 手机
- `2000020001` - 笔记本电脑
- `2000030001` - 平板电脑
- `2000040001` - 耳机

---

## 🔍 验证恢复成功

### 在MySQL中验证：

```sql
USE meituan_product;

-- 1. 检查表是否存在
SHOW TABLES LIKE 't_product';

-- 2. 查看商品数量（应该是20）
SELECT COUNT(*) FROM t_product WHERE deleted = 0;

-- 3. 查看前5个商品
SELECT id, product_name, price FROM t_product WHERE deleted = 0 LIMIT 5;
```

### 在前端验证：

1. 打开系统
2. 进入"商品管理"或"批量上传"
3. 应该能看到20个商品
4. 商品信息完整（名称、价格、库存等）

---

## 📝 表结构说明

```sql
CREATE TABLE `t_product` (
  `id` BIGINT AUTO_INCREMENT,              -- 主键ID
  `merchant_id` BIGINT,                    -- 商家ID（默认1）
  `product_name` VARCHAR(255),             -- 商品名称
  `category_id` VARCHAR(20),               -- 类目ID（10位数字）
  `price` DECIMAL(10,2),                   -- 价格
  `stock` INT,                             -- 库存
  `description` TEXT,                      -- 商品描述
  `image_url` VARCHAR(500),                -- 图片URL
  `status` TINYINT,                        -- 状态（0待上传/1已上传/2失败）
  `meituan_product_id` VARCHAR(50),        -- 美团商品ID
  `created_time` DATETIME,                 -- 创建时间
  `updated_time` DATETIME,                 -- 更新时间
  `deleted` TINYINT,                       -- 逻辑删除（0未删除/1已删除）
  PRIMARY KEY (`id`)
);
```

---

## 💡 如果还需要更多数据

### 方法1：使用批量导入功能

1. 准备Excel文件（包含商品信息）
2. 打开系统 → 批量导入
3. 上传Excel文件
4. 等待导入完成

### 方法2：手动添加SQL

在 `重建商品表.sql` 的INSERT语句中添加更多数据：

```sql
INSERT INTO `t_product` 
(`merchant_id`, `product_name`, `category_id`, `price`, `stock`, `description`, `image_url`, `status`, `deleted`) 
VALUES
(1, '你的商品名称', '2000010001', 999.00, 100, '商品描述', 'https://example.com/image.jpg', 0, 0);
```

---

## 🛡️ 预防措施

### 1. 定期备份数据库

```bash
# 备份整个数据库
mysqldump -h 106.55.102.48 -u root -p meituan_product > backup_$(date +%Y%m%d).sql

# 只备份商品表
mysqldump -h 106.55.102.48 -u root -p meituan_product t_product > t_product_backup.sql
```

### 2. 使用事务

在执行危险操作前：

```sql
START TRANSACTION;

-- 执行操作
DELETE FROM t_product WHERE ...;

-- 如果出错，回滚
ROLLBACK;

-- 如果正确，提交
COMMIT;
```

### 3. 先查询再删除

```sql
-- 先查看要删除的数据
SELECT * FROM t_product WHERE ...;

-- 确认无误后再删除
DELETE FROM t_product WHERE ...;
```

---

## 🆘 如果恢复失败

### 检查1：数据库连接

```bash
mysql -h 106.55.102.48 -u root -p
```

能否成功连接？

### 检查2：数据库是否存在

```sql
SHOW DATABASES LIKE 'meituan_product';
```

### 检查3：权限问题

```sql
SHOW GRANTS FOR CURRENT_USER();
```

是否有CREATE、INSERT权限？

### 检查4：查看错误信息

执行脚本时，仔细查看错误提示，可能是：
- 语法错误
- 权限不足
- 磁盘空间不足
- 字符集问题

---

## 📞 需要帮助？

如果恢复失败，请提供：

1. **错误信息**
   - 执行脚本时的完整错误提示

2. **数据库状态**
   ```sql
   SHOW TABLES;
   SELECT VERSION();
   ```

3. **权限信息**
   ```sql
   SHOW GRANTS;
   ```

---

**创建日期**: 2026-02-09  
**脚本文件**: `重建商品表.sql`  
**测试数据**: 20个商品  
**状态**: ✅ 可用
