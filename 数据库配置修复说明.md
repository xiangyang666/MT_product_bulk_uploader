# 数据库配置修复说明

## 问题描述
后端启动时报错：`Unknown database 'meituan'`

## 根本原因
数据库名称不匹配：
- 初始化脚本创建的数据库：`meituan_product`
- 应用配置连接的数据库：`meituan`

## 解决方案

### 已修复
✅ 已将 `application.yml` 中的数据库名称从 `meituan` 改为 `meituan_product`

### 需要执行的步骤

#### 1. 初始化数据库

**如果数据库已经存在（出现"PROCEDURE already exists"错误）：**

使用安全重新初始化脚本：

```bash
# 方法1：命令行执行
mysql -u root -p < database-reinit-safe.sql

# 方法2：在 MySQL 客户端中执行
mysql -u root -p
source database-reinit-safe.sql
```

**如果是全新安装：**

```bash
# 方法1：命令行执行
mysql -u root -p < database-init.sql

# 方法2：在 MySQL 客户端中执行
mysql -u root -p
source database-init.sql
```

**说明：**
- `database-reinit-safe.sql` 会先删除已存在的对象（表、视图、存储过程），然后重新创建
- 这个脚本可以安全地重复执行，不会报错
- ⚠️ 注意：重新初始化会清空所有数据，请确保已备份重要数据

#### 2. 验证数据库
```sql
-- 查看数据库
SHOW DATABASES LIKE 'meituan%';

-- 切换到数据库
USE meituan_product;

-- 查看表
SHOW TABLES;

-- 查看测试数据
SELECT * FROM product;
SELECT * FROM merchant;
SELECT * FROM user;
```

#### 3. 重启后端服务
数据库初始化完成后，重新启动后端服务：

```bash
cd meituan-backend
mvn spring-boot:run
```

## 配置说明

### 数据库连接信息
- **数据库名**: `meituan_product`
- **主机**: `localhost`
- **端口**: `3306`
- **用户名**: `root`
- **密码**: `root`

如果你的 MySQL 配置不同，请修改 `meituan-backend/src/main/resources/application.yml`：

```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/meituan_product?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
    username: root  # 修改为你的用户名
    password: root  # 修改为你的密码
```

## 测试数据

初始化脚本会自动创建：
- 1个测试商家（ID: 1）
- 1个管理员用户（用户名: admin, 密码: 123456）
- 5个测试商品

## 常见问题

### Q1: 出现 "PROCEDURE already exists" 错误
**A**: 数据库已经部分初始化过，使用 `database-reinit-safe.sql` 脚本重新初始化：
```bash
mysql -u root -p < database-reinit-safe.sql
```

### Q2: MySQL 连接被拒绝
**A**: 确保 MySQL 服务正在运行：
```bash
# Windows
net start MySQL80

# 或检查服务状态
sc query MySQL80
```

### Q3: 密码错误
**A**: 修改 `application.yml` 中的密码为你的 MySQL root 密码

### Q4: 字符集问题
**A**: 确保 MySQL 配置支持 utf8mb4：
```sql
SHOW VARIABLES LIKE 'character%';
```

## 下一步
数据库配置完成后，系统应该能够正常启动并连接数据库。
