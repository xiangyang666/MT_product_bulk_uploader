# 前端环境配置说明

## 📋 环境配置

项目已配置开发环境和生产环境，自动切换后端 API 地址。

### 开发环境
- **API 地址**: `http://localhost:8080`
- **用途**: 本地开发调试
- **配置文件**: `.env.development`

### 生产环境
- **API 地址**: `http://106.55.102.48:8080`
- **用途**: 打包后的应用
- **配置文件**: `.env.production`

---

## 🚀 使用方法

### 开发模式（使用本地后端）

```bash
cd meituan-frontend

# 启动开发服务器
npm run dev

# 或使用 pnpm
pnpm run dev
```

此时前端会连接到 `http://localhost:8080` 的后端服务。

### 生产打包（使用远程后端）

```bash
cd meituan-frontend

# 打包 Electron 应用
npm run electron:build:win

# 或使用 pnpm
pnpm run electron:build:win
```

打包后的应用会自动连接到 `http://106.55.102.48:8080` 的远程后端。

---

## 📝 配置文件说明

### .env.development
```env
# 开发环境配置
VITE_APP_ENV=development
VITE_API_BASE_URL=http://localhost:8080
```

### .env.production
```env
# 生产环境配置
VITE_APP_ENV=production
VITE_API_BASE_URL=http://106.55.102.48:8080
```

### vite.config.js
```javascript
// 自动根据环境加载对应的 .env 文件
export default defineConfig(({ mode }) => {
  const env = loadEnv(mode, process.cwd())
  
  return {
    server: {
      proxy: {
        '/api': {
          target: env.VITE_API_BASE_URL,
          changeOrigin: true
        }
      }
    }
  }
})
```

---

## 🔧 修改配置

### 修改开发环境后端地址

编辑 `.env.development`:
```env
VITE_API_BASE_URL=http://your-dev-server:8080
```

### 修改生产环境后端地址

编辑 `.env.production`:
```env
VITE_API_BASE_URL=http://your-prod-server:8080
```

---

## 🧪 测试配置

### 查看当前环境

打开浏览器控制台，应该能看到：
```
当前环境: development (或 production)
API 地址: http://localhost:8080 (或 http://106.55.102.48:8080)
```

### 测试 API 连接

```javascript
// 在浏览器控制台执行
import { API_BASE_URL } from '@/config'
console.log('API 地址:', API_BASE_URL)
```

---

## 📊 环境变量列表

| 变量名 | 说明 | 开发环境 | 生产环境 |
|--------|------|----------|----------|
| VITE_APP_ENV | 当前环境 | development | production |
| VITE_API_BASE_URL | 后端 API 地址 | http://localhost:8080 | http://106.55.102.48:8080 |

---

## 🐛 常见问题

### 1. API 请求失败

**检查项：**
- 后端服务是否启动
- API 地址是否正确
- 网络是否连通

**解决方案：**
```bash
# 检查后端服务
curl http://localhost:8080/api/products/stats

# 或检查远程服务
curl http://106.55.102.48:8080/api/products/stats
```

### 2. 开发环境连接到了生产服务器

**原因：** 环境变量未正确加载

**解决方案：**
```bash
# 清理缓存重新启动
rm -rf node_modules/.vite
npm run dev
```

### 3. 生产环境连接到了本地服务器

**原因：** 打包时使用了错误的环境

**解决方案：**
```bash
# 确保使用生产模式打包
npm run electron:build:win
# 而不是
npm run dev
```

---

## 📚 相关文件

- `.env.development` - 开发环境配置
- `.env.production` - 生产环境配置
- `vite.config.js` - Vite 配置
- `src/config/index.js` - 应用配置
- `src/api/index.js` - API 请求配置

---

## ✅ 配置检查清单

开发前：
- [ ] `.env.development` 文件存在
- [ ] 本地后端服务已启动（localhost:8080）
- [ ] 开发服务器启动成功（localhost:5173）

打包前：
- [ ] `.env.production` 文件存在
- [ ] 远程后端服务可访问（106.55.102.48:8080）
- [ ] 代码已提交

打包后：
- [ ] 安装包已生成
- [ ] 安装测试通过
- [ ] API 连接测试通过

---

**配置完成！现在开发和生产环境会自动使用不同的后端地址。**
