# 开发者工具密码功能 - 测试指南

## 测试环境准备

### 1. 数据库迁移

```bash
# 执行数据库迁移脚本
mysql -u root -p meituan_product < database-migration-dev-tools-password.sql
```

### 2. 后端部署

```bash
cd meituan-backend
mvn clean package -DskipTests
# 重启后端服务
```

### 3. 前端部署

```bash
cd meituan-frontend
npm install
npm run build
# 部署 dist 目录到服务器
```

## 测试用例

### 测试用例 1: 设置开发者工具密码（admin-plus）

**前置条件**:
- 使用 admin-plus 账号登录

**测试步骤**:
1. 登录系统（用户名: admin-plus）
2. 点击左侧菜单"成员管理"
3. 点击页面右上角"开发者工具设置"按钮（黄色按钮，带工具图标）
4. 在弹出的对话框中输入密码: `test123456`
5. 在确认密码框中再次输入: `test123456`
6. 点击"确定"按钮

**预期结果**:
- ✅ 显示"开发者工具密码设置成功"提示
- ✅ 对话框自动关闭
- ✅ 开发者工具保护自动启用

**验证方法**:
```bash
# 查询数据库验证密码已保存
mysql -u root -p meituan_product -e "SELECT * FROM dev_tools_config WHERE config_key='dev_tools_password';"
```

---

### 测试用例 2: 非 admin-plus 用户不能看到设置按钮

**前置条件**:
- 使用超级管理员或普通用户登录

**测试步骤**:
1. 使用非 admin-plus 账号登录
2. 进入"成员管理"页面

**预期结果**:
- ✅ 页面右上角不显示"开发者工具设置"按钮
- ✅ 只显示"创建成员"按钮（如果有权限）

---

### 测试用例 3: F12 键拦截和密码验证

**前置条件**:
- 已设置开发者工具密码
- 使用任意账号登录系统

**测试步骤**:
1. 登录系统
2. 按下 F12 键

**预期结果**:
- ✅ F12 键被拦截，开发者工具不会打开
- ✅ 弹出密码输入对话框
- ✅ 对话框标题为"开发者工具访问验证"
- ✅ 提示"请输入开发者工具密码"

**测试步骤（继续）**:
3. 输入错误密码: `wrongpassword`
4. 点击"确定"

**预期结果**:
- ✅ 显示"密码错误，请重试"提示
- ✅ 对话框不关闭，可以重新输入
- ✅ 开发者工具仍然无法打开

**测试步骤（继续）**:
5. 输入正确密码: `test123456`
6. 点击"确定"

**预期结果**:
- ✅ 显示"密码验证通过"提示
- ✅ 显示"请再次按 F12 或右键打开开发者工具"提示
- ✅ 对话框关闭
- ✅ 保护临时禁用（3秒）

**测试步骤（继续）**:
7. 在3秒内再次按 F12

**预期结果**:
- ✅ 开发者工具成功打开
- ✅ 3秒后保护自动重新启用

---

### 测试用例 4: 右键菜单拦截

**前置条件**:
- 已设置开发者工具密码
- 使用任意账号登录系统

**测试步骤**:
1. 登录系统
2. 在页面任意位置点击鼠标右键

**预期结果**:
- ✅ 右键菜单被拦截，不显示浏览器默认菜单
- ✅ 弹出密码输入对话框

**测试步骤（继续）**:
3. 输入正确密码并确定
4. 在3秒内再次点击右键

**预期结果**:
- ✅ 显示浏览器默认右键菜单
- ✅ 可以选择"检查"或"审查元素"打开开发者工具

---

### 测试用例 5: 快捷键拦截（Ctrl+Shift+I）

**前置条件**:
- 已设置开发者工具密码
- 使用任意账号登录系统

**测试步骤**:
1. 登录系统
2. 按下 Ctrl+Shift+I（Windows/Linux）或 Cmd+Option+I（Mac）

**预期结果**:
- ✅ 快捷键被拦截
- ✅ 弹出密码输入对话框
- ✅ 输入正确密码后可以打开开发者工具

---

### 测试用例 6: 快捷键拦截（Ctrl+Shift+J）

**前置条件**:
- 已设置开发者工具密码
- 使用任意账号登录系统

**测试步骤**:
1. 登录系统
2. 按下 Ctrl+Shift+J（Windows/Linux）或 Cmd+Option+J（Mac）

**预期结果**:
- ✅ 快捷键被拦截
- ✅ 弹出密码输入对话框

---

### 测试用例 7: 快捷键拦截（Ctrl+Shift+C）

**前置条件**:
- 已设置开发者工具密码
- 使用任意账号登录系统

**测试步骤**:
1. 登录系统
2. 按下 Ctrl+Shift+C（Windows/Linux）或 Cmd+Option+C（Mac）

**预期结果**:
- ✅ 快捷键被拦截
- ✅ 弹出密码输入对话框

---

### 测试用例 8: 密码输入验证

**前置条件**:
- 已设置开发者工具密码
- 使用任意账号登录系统

**测试步骤**:
1. 按 F12 打开密码对话框
2. 不输入密码，直接点击"确定"

**预期结果**:
- ✅ 显示"密码不能为空"错误提示
- ✅ 对话框不关闭

**测试步骤（继续）**:
3. 输入少于6个字符的密码: `12345`
4. 点击"确定"

**预期结果**:
- ✅ 显示"密码长度至少6个字符"错误提示
- ✅ 对话框不关闭

---

### 测试用例 9: 修改密码

**前置条件**:
- 已设置开发者工具密码
- 使用 admin-plus 账号登录

**测试步骤**:
1. 进入"成员管理"页面
2. 点击"开发者工具设置"按钮
3. 输入新密码: `newpassword123`
4. 确认新密码: `newpassword123`
5. 点击"确定"

**预期结果**:
- ✅ 显示"开发者工具密码设置成功"提示
- ✅ 对话框关闭

**测试步骤（继续）**:
6. 按 F12 键
7. 输入旧密码: `test123456`
8. 点击"确定"

**预期结果**:
- ✅ 显示"密码错误，请重试"提示

**测试步骤（继续）**:
9. 输入新密码: `newpassword123`
10. 点击"确定"

**预期结果**:
- ✅ 显示"密码验证通过"提示
- ✅ 可以打开开发者工具

---

### 测试用例 10: 取消密码输入

**前置条件**:
- 已设置开发者工具密码
- 使用任意账号登录系统

**测试步骤**:
1. 按 F12 打开密码对话框
2. 点击"取消"按钮

**预期结果**:
- ✅ 对话框关闭
- ✅ 开发者工具不打开
- ✅ 保护继续生效

---

### 测试用例 11: 未设置密码时的行为

**前置条件**:
- 未设置开发者工具密码（新系统或删除了密码配置）

**测试步骤**:
1. 登录系统
2. 按 F12 键

**预期结果**:
- ✅ 开发者工具正常打开
- ✅ 不弹出密码对话框
- ✅ 右键菜单正常显示

---

### 测试用例 12: 密码设置权限验证（API层）

**前置条件**:
- 使用非 admin-plus 账号登录

**测试步骤**:
1. 使用 Postman 或 curl 直接调用设置密码 API

```bash
curl -X POST http://localhost:8080/api/dev-tools/password \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <非admin-plus用户的token>" \
  -d '{"password": "hacker123"}'
```

**预期结果**:
- ✅ 返回 HTTP 200，但 message 为"权限不足，只有 admin-plus 可以设置开发者工具密码"
- ✅ 数据库中密码未被修改

---

### 测试用例 13: 密码验证 API

**前置条件**:
- 已设置开发者工具密码

**测试步骤**:
1. 调用密码验证 API

```bash
# 验证正确密码
curl -X POST http://localhost:8080/api/dev-tools/password/verify \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{"password": "test123456"}'
```

**预期结果**:
```json
{
  "code": 200,
  "message": "密码验证通过",
  "data": {
    "valid": true
  }
}
```

**测试步骤（继续）**:
2. 验证错误密码

```bash
curl -X POST http://localhost:8080/api/dev-tools/password/verify \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{"password": "wrongpassword"}'
```

**预期结果**:
```json
{
  "code": 200,
  "message": "密码验证失败",
  "data": {
    "valid": false
  }
}
```

---

### 测试用例 14: 密码状态查询 API

**前置条件**:
- 已设置开发者工具密码

**测试步骤**:
```bash
curl -X GET http://localhost:8080/api/dev-tools/password/status \
  -H "Authorization: Bearer <token>"
```

**预期结果**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "hasPassword": true
  }
}
```

---

### 测试用例 15: 页面刷新后保护仍然生效

**前置条件**:
- 已设置开发者工具密码
- 使用任意账号登录系统

**测试步骤**:
1. 登录系统
2. 刷新页面（F5 或 Ctrl+R）
3. 等待页面加载完成
4. 按 F12 键

**预期结果**:
- ✅ 弹出密码输入对话框
- ✅ 保护功能正常工作

---

### 测试用例 16: 多标签页独立保护

**前置条件**:
- 已设置开发者工具密码
- 使用任意账号登录系统

**测试步骤**:
1. 在标签页 A 登录系统
2. 在标签页 A 按 F12，输入正确密码，打开开发者工具
3. 打开新标签页 B，访问同一系统
4. 在标签页 B 按 F12

**预期结果**:
- ✅ 标签页 B 仍然弹出密码对话框
- ✅ 每个标签页的保护是独立的

---

## 性能测试

### 测试用例 17: 密码验证响应时间

**测试步骤**:
1. 按 F12 打开密码对话框
2. 输入正确密码
3. 点击"确定"
4. 记录从点击到收到响应的时间

**预期结果**:
- ✅ 响应时间 < 500ms
- ✅ 用户体验流畅

---

### 测试用例 18: 页面加载性能

**测试步骤**:
1. 清除浏览器缓存
2. 登录系统
3. 使用浏览器开发者工具的 Performance 面板记录页面加载

**预期结果**:
- ✅ 开发者工具保护初始化不影响页面加载速度
- ✅ 初始化时间 < 100ms

---

## 安全测试

### 测试用例 19: SQL 注入测试

**测试步骤**:
```bash
curl -X POST http://localhost:8080/api/dev-tools/password/verify \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{"password": "test123456\" OR \"1\"=\"1"}'
```

**预期结果**:
- ✅ 返回密码验证失败
- ✅ 不会导致 SQL 注入

---

### 测试用例 20: XSS 攻击测试

**测试步骤**:
1. 尝试设置包含 XSS 脚本的密码

```bash
curl -X POST http://localhost:8080/api/dev-tools/password \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <admin-plus-token>" \
  -d '{"password": "<script>alert(\"XSS\")</script>"}'
```

**预期结果**:
- ✅ 密码被正常保存（作为普通字符串）
- ✅ 验证时不会执行脚本

---

## 兼容性测试

### 浏览器兼容性

测试以下浏览器：

- ✅ Chrome 最新版
- ✅ Firefox 最新版
- ✅ Edge 最新版
- ✅ Safari 最新版（Mac）

### 操作系统兼容性

- ✅ Windows 10/11
- ✅ macOS
- ✅ Linux (Ubuntu)

---

## 回归测试

### 测试用例 21: 其他功能不受影响

**测试步骤**:
1. 测试商品管理功能
2. 测试批量导入功能
3. 测试模板管理功能
4. 测试成员管理功能

**预期结果**:
- ✅ 所有现有功能正常工作
- ✅ 开发者工具保护不影响业务功能

---

## 测试报告模板

```markdown
# 开发者工具密码功能测试报告

## 测试信息
- 测试人员: [姓名]
- 测试日期: [日期]
- 测试环境: [环境描述]
- 后端版本: [版本号]
- 前端版本: [版本号]

## 测试结果汇总
- 总测试用例数: 21
- 通过: [数量]
- 失败: [数量]
- 阻塞: [数量]

## 详细测试结果

| 用例编号 | 用例名称 | 测试结果 | 备注 |
|---------|---------|---------|------|
| TC-01 | 设置开发者工具密码 | ✅ 通过 | |
| TC-02 | 非 admin-plus 不能看到设置按钮 | ✅ 通过 | |
| ... | ... | ... | ... |

## 发现的问题

### 问题 1
- 严重程度: [高/中/低]
- 描述: [问题描述]
- 重现步骤: [步骤]
- 预期结果: [预期]
- 实际结果: [实际]

## 测试结论
[通过/不通过]

## 建议
[改进建议]
```

---

## 快速验证脚本

```bash
#!/bin/bash

echo "=== 开发者工具密码功能快速验证 ==="

# 1. 检查数据库表
echo "1. 检查数据库表..."
mysql -u root -p meituan_product -e "SHOW TABLES LIKE 'dev_tools_config';"

# 2. 检查是否已设置密码
echo "2. 检查密码设置状态..."
curl -s http://localhost:8080/api/dev-tools/password/status \
  -H "Authorization: Bearer YOUR_TOKEN" | jq .

# 3. 测试密码验证（需要先设置密码）
echo "3. 测试密码验证..."
curl -s -X POST http://localhost:8080/api/dev-tools/password/verify \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{"password": "test123456"}' | jq .

echo "=== 验证完成 ==="
```

---

## 常见问题排查

### 问题 1: 密码对话框不弹出

**排查步骤**:
1. 检查浏览器控制台是否有错误
2. 确认是否已设置密码（调用状态查询 API）
3. 检查 `devToolsProtection.js` 是否正确加载
4. 确认 `App.vue` 中的初始化代码是否执行

### 问题 2: 密码验证失败

**排查步骤**:
1. 检查后端日志
2. 确认密码是否正确
3. 检查数据库中的密码哈希值
4. 确认 BCrypt 加密是否正常工作

### 问题 3: 保护不生效

**排查步骤**:
1. 检查是否已设置密码
2. 确认 `initDevToolsProtection()` 是否被调用
3. 检查事件监听器是否正确绑定
4. 查看浏览器控制台日志

---

## 测试完成检查清单

- [ ] 所有测试用例执行完毕
- [ ] 测试报告已生成
- [ ] 发现的问题已记录
- [ ] 关键问题已修复
- [ ] 回归测试已通过
- [ ] 性能测试已通过
- [ ] 安全测试已通过
- [ ] 兼容性测试已通过
- [ ] 文档已更新
- [ ] 代码已提交到版本控制系统
