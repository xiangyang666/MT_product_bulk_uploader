# 商品管理 - 状态字段说明

## 📊 状态字段含义

在"商品管理"页面的表格中，**状态**列显示每个商品当前的上传状态。

### 状态类型

| 状态显示 | 数据库值 | 颜色标签 | 含义说明 |
|---------|---------|---------|---------|
| **待上传** | 0 | 灰色 (info) | 商品已导入系统，但还未生成模板或上传到美团 |
| **已上传** | 1 | 绿色 (success) | 商品已成功上传到美团后台 |
| **上传失败** | 2 | 红色 (danger) | 商品上传到美团时失败 |

---

## 🔄 状态流转

### 正常流程

```
1. 导入商品
   ↓
   状态：待上传（灰色）
   ↓
2. 生成模板并下载
   ↓
   状态：待上传（灰色）
   ↓
3. 手动上传到美团后台
   ↓
   状态：已上传（绿色）
```

### 失败流程

```
1. 导入商品
   ↓
   状态：待上传（灰色）
   ↓
2. 上传到美团时出错
   ↓
   状态：上传失败（红色）
   ↓
3. 修正数据后重新上传
   ↓
   状态：已上传（绿色）
```

---

## 💡 状态说明

### 1. 待上传（灰色）

**含义**：
- 商品数据已经导入到系统中
- 可以生成美团模板
- 还没有上传到美团后台

**操作建议**：
1. 进入"批量上传"页面
2. 选择这些商品
3. 点击"生成模板"
4. 下载文件后上传到美团

**常见场景**：
- 刚导入的新商品
- 准备上传但还未操作的商品
- 生成模板后还未上传的商品

---

### 2. 已上传（绿色）

**含义**：
- 商品已成功上传到美团后台
- 在美团商家后台可以看到这个商品
- 可以在美团平台上销售

**操作建议**：
- 无需操作，商品已正常上架
- 如需更新信息，可重新导入并上传

**常见场景**：
- 成功上传到美团的商品
- 已在美团平台销售的商品

---

### 3. 上传失败（红色）

**含义**：
- 尝试上传到美团时出现错误
- 可能是数据格式问题
- 可能是美团后台拒绝

**操作建议**：
1. 查看"操作日志"了解失败原因
2. 检查商品数据是否完整
3. 修正数据后重新上传

**常见原因**：
- 必填字段缺失（如商品名称、类目ID）
- 价格或库存格式不正确
- 类目ID不存在或无效
- 美团后台网络问题

---

## 🎯 实际使用场景

### 场景 1：每日导入新品

```
第1天：
- 导入 100 个新商品
- 状态：全部显示"待上传"（灰色）
- 生成模板并上传到美团
- 状态：全部变为"已上传"（绿色）

第2天：
- 导入 50 个新商品
- 状态：新商品显示"待上传"（灰色）
- 昨天的商品仍显示"已上传"（绿色）
```

### 场景 2：批量更新价格

```
1. 导入包含新价格的 Excel
2. 系统更新商品信息
3. 状态保持不变（如果之前是"已上传"）
4. 重新生成模板并上传
5. 美团后台的价格会更新
```

### 场景 3：清空重新上货

```
1. 点击"清空商品"
2. 所有商品从系统中删除
3. 重新导入新的商品数据
4. 状态：全部显示"待上传"（灰色）
5. 生成模板并上传
6. 状态：变为"已上传"（绿色）
```

---

## 📝 注意事项

### 1. 状态不会自动更新

⚠️ **重要**：系统无法自动检测美团后台的上传状态

- 状态需要手动更新或通过系统操作更新
- 如果手动在美团后台上传，系统状态不会自动变化
- 建议通过系统生成模板并记录上传结果

### 2. 状态仅供参考

- 状态字段主要用于跟踪商品在系统中的处理进度
- 实际商品是否在美团上架，以美团后台为准
- 可以通过"操作日志"查看详细的上传记录

### 3. 批量操作

- 可以按状态筛选商品（功能待开发）
- 可以批量选择"待上传"的商品生成模板
- 可以查看"上传失败"的商品并重新处理

---

## 🔍 如何查看状态

### 在商品管理页面

1. 打开系统：http://localhost:5173
2. 登录后进入"商品管理"
3. 查看表格中的"状态"列
4. 不同状态用不同颜色的标签显示

### 状态颜色

- 🔵 **灰色标签** = 待上传
- 🟢 **绿色标签** = 已上传
- 🔴 **红色标签** = 上传失败

---

## 💻 技术细节

### 数据库字段

```sql
-- t_product 表
status INT DEFAULT 0 COMMENT '状态：0-待上传，1-已上传，2-上传失败'
```

### 前端显示逻辑

```javascript
const getStatusType = (status) => {
  const typeMap = {
    '已上传': 'success',    // 绿色
    '待上传': 'info',       // 灰色
    '上传失败': 'danger'    // 红色
  }
  return typeMap[status] || 'info'
}
```

### 后端枚举定义

```java
public enum Status {
    PENDING(0, "待上传"),
    UPLOADED(1, "已上传"),
    FAILED(2, "上传失败");
}
```

---

## 📊 状态统计

可以通过以下 SQL 查询各状态的商品数量：

```sql
USE meituan_product;

SELECT 
    CASE status
        WHEN 0 THEN '待上传'
        WHEN 1 THEN '已上传'
        WHEN 2 THEN '上传失败'
        ELSE '未知'
    END AS status_name,
    COUNT(*) AS count
FROM t_product
WHERE deleted = 0
GROUP BY status;
```

---

## 🎯 总结

**状态字段的作用**：
1. ✅ 跟踪商品处理进度
2. ✅ 识别哪些商品需要上传
3. ✅ 发现上传失败的商品
4. ✅ 管理商品生命周期

**使用建议**：
- 定期检查"待上传"的商品
- 及时处理"上传失败"的商品
- 通过"操作日志"了解详细信息
- 保持系统数据与美团后台同步

---

**文档更新日期**：2026-02-09  
**适用版本**：v1.0.0  
**状态**：✅ 当前有效
