# 应用版本管理 - 流式上传改进

## 改进内容

### 1. 支持同时上传多个文件
- ✅ 可以同时拖入 Windows (.exe) 和 macOS (.dmg) 文件
- ✅ 自动检测文件平台类型
- ✅ 同一平台的文件会自动替换（避免重复）
- ✅ 最多支持 2 个文件（Windows + macOS）

### 2. 流式上传
- ✅ 每个文件独立上传，不会互相阻塞
- ✅ 显示每个文件的独立上传进度
- ✅ 一个文件失败不影响其他文件继续上传
- ✅ 实时显示上传状态（等待、上传中、成功、失败）

### 3. 断点续传
- ✅ 上传失败的文件可以单独重试
- ✅ 点击"重试"按钮继续上传失败的文件
- ✅ 不需要重新上传已成功的文件
- ✅ 显示详细的错误信息

### 4. 智能版本号管理
- ✅ 自动获取最新版本号
- ✅ 自动递增补丁版本号（如 1.0.0 → 1.0.1）
- ✅ 支持多平台版本号同步
- ✅ 无历史版本时默认为 1.0.0

### 5. 用户体验优化
- ✅ 清晰的进度显示（完成数/总数）
- ✅ 每个文件显示独立的进度条和状态图标
- ✅ 失败文件高亮显示，便于识别
- ✅ 智能按钮文本（显示上传进度）
- ✅ 上传中禁止关闭对话框
- ✅ 版本号加载状态提示

## 使用方法

### 上传单个文件
1. 点击"上传新版本"按钮
2. 拖入或选择 .exe 或 .dmg 文件
3. 输入版本号（如 1.0.0）
4. 填写发布说明（可选）
5. 点击"开始上传"

### 同时上传多个文件
1. 点击"上传新版本"按钮
2. 同时拖入 .exe 和 .dmg 文件（或分别选择）
3. 输入版本号（两个文件使用相同版本号）
4. 填写发布说明（可选）
5. 点击"开始上传"
6. 系统会依次上传每个文件，显示各自进度

### 断点续传
1. 如果某个文件上传失败
2. 在失败的文件卡片上点击"重试"按钮
3. 系统会重新上传该文件
4. 已成功的文件不会重新上传

## 技术实现

### 核心改进
```javascript
// 1. 支持多文件选择
multiple: true
limit: 2

// 2. 流式上传 - 顺序上传每个文件
for (const task of uploadTasks.value) {
  await uploadSingleFile(task)
}

// 3. 独立的任务状态管理
uploadTasks.value = [
  {
    id: 'task-1',
    file: file1,
    status: 'uploading', // waiting, uploading, success, error
    progress: 45,
    error: null
  }
]

// 4. 重试机制
const retryUpload = async (task) => {
  await uploadSingleFile(task)
  checkAllCompleted()
}

// 5. 智能版本号递增
const incrementVersion = (version) => {
  const [major, minor, patch] = version.split('.').map(Number)
  return `${major}.${minor}.${patch + 1}`
}

// 6. 自动获取最新版本
watch(detectedPlatforms, (newPlatforms) => {
  if (newPlatforms.length > 0 && !form.version) {
    fetchAndSetDefaultVersion()
  }
})
```

### 状态管理
- **waiting**: 等待上传
- **uploading**: 正在上传
- **success**: 上传成功
- **error**: 上传失败（可重试）

### 进度追踪
- 每个文件独立的进度条（0-100%）
- 总体进度显示（完成数/总数）
- 实时更新上传百分比

## 界面展示

### 上传任务列表
```
上传进度                    1/2 完成
┌─────────────────────────────────────┐
│ ✓ 美团商品上传工具-1.0.0-x64.exe    │
│   Windows                      100% │
│ ████████████████████████████████    │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ ⟳ 美团商品上传工具-1.0.0-arm64.dmg  │
│   macOS                         45% │重试
│ ████████████░░░░░░░░░░░░░░░░░░░░    │
│ ⚠ 网络连接超时，请重试              │
└─────────────────────────────────────┘
```

## 优势

1. **更高效**: 一次性上传多个平台的文件
2. **更可靠**: 失败后可以单独重试，不影响其他文件
3. **更直观**: 清晰的进度显示和状态反馈
4. **更友好**: 详细的错误信息和重试机制
5. **更智能**: 自动递增版本号，无需手动计算

## 版本号自动递增逻辑

### 工作流程
1. 用户拖入文件后，系统自动检测平台（Windows/macOS）
2. 根据检测到的平台，获取该平台的最新版本号
3. 自动递增补丁版本号（第三位数字 +1）
4. 填充到版本号输入框

### 示例
- 当前最新版本：`1.0.5`
- 自动生成版本：`1.0.6`

- 当前最新版本：`2.3.9`
- 自动生成版本：`2.3.10`

### 特殊情况处理
- **无历史版本**: 默认使用 `1.0.0`
- **多平台上传**: 优先使用 Windows 平台的版本号
- **获取失败**: 尝试备用平台，都失败则使用 `1.0.0`
- **手动修改**: 用户可以随时修改自动生成的版本号

## 注意事项

- 单个文件最大 500MB
- 所有文件使用相同的版本号
- 上传中请勿关闭对话框
- 大文件上传可能需要几分钟，请耐心等待
