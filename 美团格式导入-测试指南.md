# 美团格式导入 - 测试指南

## ✅ 已完成的工作

### 1. 格式自动识别
- 系统会自动识别美团格式（50+列）和标准格式（6列）
- 美团格式识别条件：包含"商品类目ID"、"商品名称"、"价格"列

### 2. 移除所有数据验证
- ✅ 不验证商品名称是否为空
- ✅ 不验证类目ID格式（不需要10位数字）
- ✅ 不验证价格范围
- ✅ 不限制描述和URL长度
- ✅ 所有数据直接导入，不拒绝任何行

### 3. 字段映射
美团格式 → 系统字段：
- 商品名称 → productName
- 商品类目ID → categoryId
- 价格 → price
- 库存 → stock
- 文字详情 → description

## 🧪 测试步骤

### 步骤1：重启后端服务

```bash
# 方法1：使用启动脚本
start-backend.bat

# 方法2：如果服务正在运行，先停止（Ctrl+C），然后重新启动
```

### 步骤2：访问导入页面

打开浏览器访问：`http://localhost:5173/import`

### 步骤3：上传美团文件

文件位置：`E:\YCZL-company\order_project\MT_product_bulk_uploader\资源\商品的类目信息.xlsx`

1. 点击"选择文件"按钮
2. 选择上述文件
3. 点击"预览"按钮

### 步骤4：查看预览结果

**预期结果**：
```json
{
  "formatType": "MEITUAN",
  "formatMessage": "已识别为美团格式",
  "totalCount": 3752,
  "successCount": 3752,
  "failedCount": 0,
  "hasMoreErrors": false
}
```

**关键指标**：
- ✅ formatType 应该是 "MEITUAN"（不是 "STANDARD"）
- ✅ successCount 应该是 3752
- ✅ failedCount 应该是 0
- ✅ 不应该有"类目ID必须是10位数字"的错误
- ✅ 不应该有"商品名称不能为空"的错误

### 步骤5：确认导入

如果预览结果正确，点击"确认导入"按钮

## 🔍 问题排查

### 问题1：仍然识别为标准格式

**症状**：formatType 显示 "STANDARD" 而不是 "MEITUAN"

**排查步骤**：
1. 查看后端日志，找到 FormatDetector 输出的表头信息
2. 检查日志中是否有：
   ```
   检测到的表头列数：XX
   表头[0]: 'XXX'
   表头[1]: 'XXX'
   ...
   ```
3. 确认表头中是否包含"商品类目ID"、"商品名称"、"价格"

**可能原因**：
- 表头列名有额外的空格或特殊字符
- Excel文件格式问题

### 问题2：仍然有验证错误

**症状**：failedCount > 0，有错误信息

**排查步骤**：
1. 查看错误详情（errors 数组）
2. 检查错误类型
3. 确认后端代码是否已更新

**解决方法**：
- 确保已重启后端服务
- 确认 MeituanFormatParser.java 和 ExcelService.java 已更新
- 清理并重新编译：`mvn clean compile`

### 问题3：商品管理页面500错误

**症状**：访问商品管理页面时出现500错误

**说明**：这是数据库配置问题，不影响导入功能测试

**临时解决**：暂时忽略，专注于导入功能测试

## 📊 成功标准

导入成功的标志：
1. ✅ 格式识别为 MEITUAN
2. ✅ 所有3752行数据都成功导入（successCount = 3752）
3. ✅ 没有验证错误（failedCount = 0）
4. ✅ 数据正确保存到数据库

## 🎯 下一步

测试成功后，可以：
1. 查看导入的商品数据
2. 验证字段映射是否正确
3. 测试其他美团格式文件
4. 测试标准格式文件（确保兼容性）

---

**文档创建时间**：2026年2月9日  
**状态**：等待测试验证
